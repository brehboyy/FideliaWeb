<!DOCTYPE html>
<html lang="en">
   <head>
      <title>Login V18</title>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <!--===============================================================================================-->
      <link rel="icon" type="image/png" href="images/icons/favicon.ico" />
      <!--===============================================================================================-->
      <link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css">
      <!--===============================================================================================-->
      <link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
      <!--===============================================================================================-->
      <link rel="stylesheet" type="text/css" href="fonts/Linearicons-Free-v1.0.0/icon-font.min.css">
      <!--===============================================================================================-->
      <link rel="stylesheet" type="text/css" href="vendor/animate/animate.css">
      <!--===============================================================================================-->
      <link rel="stylesheet" type="text/css" href="vendor/css-hamburgers/hamburgers.min.css">
      <!--===============================================================================================-->
      <link rel="stylesheet" type="text/css" href="vendor/animsition/css/animsition.min.css">
      <!--===============================================================================================-->
      <link rel="stylesheet" type="text/css" href="vendor/select2/select2.min.css">
      <!--===============================================================================================-->
      <link rel="stylesheet" type="text/css" href="vendor/daterangepicker/daterangepicker.css">
      <!--===============================================================================================-->
      <link rel="stylesheet" type="text/css" href="css/util.css">
      <link rel="stylesheet" type="text/css" href="css/main.css">
      <!--===============================================================================================-->
      <!-- Font Awesome -->
      <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
      <!-- Bootstrap core CSS -->
      <link href="css/bootstrap.min.css" rel="stylesheet">
      <!-- Material Design Bootstrap -->
      <link href="css/mdb.min.css" rel="stylesheet">
      <!-- Your custom styles (optional) -->
      <link href="css/style.css" rel="stylesheet">
   </head>
   <body style="background-color: white;">
      <header>
         <div class="container">
            <div class="row" style="height: 100px;">
               <!--<div class="col-sm-3" style="background-image: url('images/logo.png');">-->
               <div class="col-sm-3">
                  <center>
                     <img src="images/logo.png" alt="Fidélia" style="width:150px; height:100px;">
                  </center>
               </div>
               <div class="col-sm-6" style="margin-top: 20px;">
                  <p style="text-align:center; font-size:1.2em;">Fidélia</p>
                  <p style="text-align:center;">Mail ou sms</p>
               </div>
            </div>
         </div>
      </header>

      <div class="container">
         <div class="row" style="height: 100px;">
            <!--<div class="col-sm-3" style="background-image: url('images/logo.png');">-->
            <div class="col-sm-3" style="text-align: center;">
               <button class="btn btn-outline-success btn-sm" style="margin: 10px;text-align: center;">
               <a href="Accueil.html">Accueil</a>
               </button>
            </div>
            <div class="col-sm-3">
               <button class="btn btn-outline-primary btn-sm" style="margin: 10px;">
               <a href="AdministrationBdd.html">Administration des tables</a>
               </button>
            </div>
            <div class="col-sm-3">
               <button class="btn btn-outline-primary btn-sm" style="margin: 10px;">
               <a href="MessagePage.html">Modèles de messages</a>
               </button>
            </div>
            <div class="col-sm-3" >
               <button class="btn btn-outline-primary btn-sm" style="margin: 10px;">
               <a href="SendMessage.html">Programmation</a>
               </button>
            </div>
         </div>
      </div>

      <div class="container">
         <form class="border border-light p-5" id="sauvegarder">
          <div id="IDModeleMessage"></div>
            <div class="permanent">
              <label>Choisir la fréquence d'envoi :</label>
               <!-- Default checked -->
               <div class="custom-control custom-radio">
                  <input type="radio" class="custom-control-input rButtonPermanent" id="defaultChecked2" name="defaultExampleRadios2" checked value="Permanent">
                  <label class="custom-control-label" for="defaultChecked2">Permanent</label>
               </div>
               <!-- Default unchecked -->
               <div class="custom-control custom-radio">
                  <input type="radio" class="custom-control-input rButtonPermanent" id="defaultUnchecked2" name="defaultExampleRadios2" value="Occasionnellement">
                  <label class="custom-control-label" for="defaultUnchecked2">Occasionnellement</label>
               </div>
            </div>
            <div id="permanent">
              <br>
               <div>
                  <label>A partir de :</label>
                  <div>
                     <label>Choisir la date :</label>
                     <input type="datetime-local" id="dateDebut">
                  </div>
               </div>

               <div>
                  <label>Selon la condition :</label>
                  <select class="browser-default custom-select mb-4" id="selectCondition">
                     <option value="" disabled="" selected="">Condition</option>
                     <option value="1">Produit de la dernière commande</option>
                     <option value="2">Date de la dernière commande</option>
                     <option value="3">Date d'anniversaire du nourrisson</option>
                  </select>
               </div>
               <div>
                  <label>Tous les :</label>
                  <input type="number" name="numberFrequence" id="numberFrequence">
               </div>
            </div>
            <div id="occasionnellement">
               <div>
                  <label>A partir de :</label>
                  <div>
                     <label>Choisir la date</label>
                     <input type="datetime-local" id="dateOcca">
                  </div>
               </div>
            </div>
            <!--Save-->
            <div class="text-center mb-3">
               <button type="submit" class="btn blue-gradient btn-block btn-rounded z-depth-1a">Sauvegarder</button>
            </div>
         </form>
      </div>
      <footer>
      </footer>
      
   </body>
   <!-- SCRIPTS -->
   <!-- JQuery -->
   <script type="text/javascript" src="js/jquery-3.4.1.min.js"></script>
   <!-- Bootstrap tooltips -->
   <script type="text/javascript" src="js/popper.min.js"></script>
   <!-- Bootstrap core JavaScript -->
   <script type="text/javascript" src="js/bootstrap.min.js"></script>
   <!-- MDB core JavaScript -->
   <script type="text/javascript" src="js/mdb.min.js"></script>
   <script src="js/main.js"></script>
   <script type="text/javascript">

      var result;
      $(document).ready(function(){
          $( "#occasionnellement" ).hide();
          $('.permanent input[type="radio"]').click(function(){
            result = $(this).val();
            switch(result){
              case 'Occasionnellement':
                $( "#permanent" ).hide( "slow", function() {
                });
               $( "#occasionnellement" ).show( "slow", function() {
                });
              break;
              case 'Permanent':
                $( "#permanent" ).show( "slow", function() {
                });
               $( "#occasionnellement" ).hide( "slow", function() {
                });
              break; 
            }
        console.log(result);
          });
      
      
      $('#dateOcca').change(function(){
          var inputdateOcca = new Date(this.value);
          dateOcca = inputdateOcca.getFullYear() + '-' + (inputdateOcca.getMonth()+1) + '-' + inputdateOcca.getDate() + ' ' + inputdateOcca.getHours() + ':' + inputdateOcca.getMinutes() +':' + inputdateOcca.getSeconds()
          console.log('Date occasionnellement (dateOcca) : ' + dateOcca);
      });
      $('#dateDebut').change(function(){
          var inputdateDebut = new Date(this.value);
          dateDebut = inputdateDebut.getFullYear() + '-' + (inputdateDebut.getMonth()+1) + '-' + inputdateDebut.getDate() + ' ' + inputdateDebut.getHours() + ':' + inputdateDebut.getMinutes() +':' + inputdateDebut.getSeconds();
          console.log('Date début permanent (dateDebut) : ' + dateDebut);

      });
      
      $('#sauvegarder').submit(function(){
        //console.log('result :' +result);
          var selectCondition = $( "#selectCondition option:selected" ).text();
          if (selectCondition = 'Condition') {selectCondition = 'Aucune condition'}
          var numberFrequence = $('#numberFrequence').val();
          /*var ID_Modele_Message = $('#ID_Modele_Message').val();*/
          var ID_Modele_Message = 1;

          var dateEnvoi;
            switch(result){
              case 'Occasionnellement':
                dateEnvoi = dateOcca;
                numberFrequence = 0;
                console.log(ID_Modele_Message);
                console.log(numberFrequence);
                console.log(dateOcca);
                console.log(result);
              break;
              case 'Permanent':
                dateEnvoi = dateDebut;
                console.log(ID_Modele_Message);
                console.log(numberFrequence);
                console.log(dateDebut);
                console.log(result);
              break; 
            }

            let programmationObject = { 
              'ID_Modele_Message': ID_Modele_Message,
              'NbTempsJour': numberFrequence, 
              'DateEnvoi': dateEnvoi, 
              'Condition': selectCondition };
        
            $.ajax({
              url: 'http://localhost/apifidelia/tests/public/message.php/insertProgrammation',
              type: 'POST',
              dataType: 'json',
              data: { 'programmation': JSON.stringify(programmationObject) },
              cache: false
            }).done(function (response) {
              alert(response.message);
            }).fail(error => {
              console.log(error.responseText);
            });
            return false;
          })
        });
      
      
   </script>
</html>
<style>
   .buttonAllModelLeft {
   width: 200px;
   size: 10px;
   margin: 10px;
   }
   .buttonAllModelRight {
   width: 800px;
   size: 10px;
   margin: 10px;
   }
</style>